<!doctype html>
<html>

<head>
    <meta charset=utf-8>
    <link rel="icon shortcut" href=img/logo.png type=image/png>
    <link rel=apple-touch-icon href=img/logo.png>
    <link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css>
    <link rel=stylesheet href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link rel=stylesheet href=css/base.css>
    <link rel=stylesheet href=css/contract.css>
    <link rel=stylesheet href=css/ui-block.css>
    <link rel=stylesheet href=codeMirror/codemirror.css>
    <link rel=stylesheet href=codeMirror/dracula.css>
    <meta name=viewport content="width=device-width">
    <title>Blockchain playground</title>
    <style>
        .wrapperExample1 .search_contract {
            background-color: #f5f5f5;
            border: none;
        }

        .wrapperExample1 .run_contract {
            background-color: #f5f5f5;
            border: none;
            margin-top: 20px;
        }

        .run_contract span {
            color: gray;
        }

        .title {
            text-align: center;
            color: black;
            font-size: 30px;
        }

        .code {
            height: 300px;
        }

        .active1 {
            display: none;
        }
    </style>
</head>

<body>
    <div class=logo-main></div>
    <div class=header></div>


    <!-- Code Editor window -->

    <div class=wrapperExample1>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" href="#search_contract" data-toggle="tab" role="tab" aria-controls="search_contract"
                    aria-selected="true">Search</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="profile-tab" href="#run_contract" data-toggle="tab" role="tab" aria-controls="search_contract" aria-selected="false">Submit</a>
            </li>

        </ul>
        <div class="tab-content">
            <!-------- search contract ---------->
            <div class="search_contract tab-pane active" id="search_contract" class="tab-pane show " role="tabpanel" aria-labelledby="home-tab">
                <div class="title">
                    <span>Search contract</span>
                </div>
                <input id="addr_input" type="text" placeholder="Please enter your TXhash">
                <span class="errmsg active1">Please enter a valid TX hash</span>
                <button class="search">search</button>
                <textarea class="search_result active1" name="search_result" id="search_result" cols="30" rows="10"></textarea>
            </div>

            <!-------- run contract   and deploy contract ---------->
            <div class="run_contract " id="run_contract" class="tab-pane" role="tabpanel" aria-labelledby="profile-tab">
                <div class="title">
                    <span>Submit Contract</span>
                </div>

                <span>function,args : </span>
                <input type="text" id="code">

                <div class=select-wallet-file></div>

                <span>From : </span>
                <input type="text" id="from_addr">

                <span>To : </span>
                <input type="text" id="to_addr">
                <br>
                <span>Value : </span>
                <input type="text" id="value">
                <br>
                <span>Gas Limit : </span>
                <span id="gas_limit"></span>
                <br>
                <span>Gas Price : </span>
                <span id="gas_price"></span>
                <br>
                <span class="errmsg_code active1">Please enter a valid code</span>

                <div class="result active1" id="result">Results:success,you can deploy this contract.</div>
                <!-- <button onclick="submit()">RUN</button> -->
                <button id="call">call</button>
                <div class="next  active1">
                    <div class="select-wallet-file"></div>
                    <button onclick="generateTransaction()">Deploy Contract</button>
                </div>
            </div>
        </div>


    </div>

    <div class=footer></div>

    <script src=codeMirror/codemirror.js></script>
    <script src=codeMirror/javascript.js></script>
    <script src=https://code.jquery.com/jquery-3.3.1.min.js></script>
    <script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js data-depends=jquery.slim></script>
    <script src=js/api.js data-depends=jquery></script>
    <script src=js/wallet.js></script>
    <script src=js/nebApi.js></script>
    <script src=js/codeEditor.js></script>
    <script src=js/home.v1.js></script>

    <script src=js/i18n.js data-depends=jquery.slim></script>
    <script src=https://cdn.bootcss.com/bootbox.js/4.4.0/bootbox.min.js data-depends="bootstrap jquery"></script>
    <script src=js/ui-block.js data-depends="bootbox jquery wallet.js"></script>
    <script>
        "use strict";

        var wallet = require("wallet"),
            Neb = wallet.Neb,
            Transaction = wallet.Transaction,
            Utils = wallet.Utils,
            neb = new Neb(),
            testnetchainID = 1001,
            unitMap = {
                none: '0',
                nis: '1',
                knis: '1000',
                mnis: '1000000',
                nanonas: '1000000000',
                micronas: '1000000000000',
                millinas: '1000000000000000',
                nas: '1000000000000000000'
            },
            gAccount, gTx;



        uiBlock({
            footer: ".footer",
            header: ".header",
            logoMain: ".logo-main",
            selectWalletFile: [".select-wallet-file", onUnlockFile]
        });

        $('#myTab a').on('click', function (e) {
            e.preventDefault();
            $(this).tab('show')
        })

        function unitValue(unit) {
            var unitValue = unitMap[(unit || "nas").toLowerCase()];

            if (unitValue === undefined)
                throw new Error('The unit undefined, please use the following units:' + JSON.stringify(unitMap, null, 2));

            return new Utils.toBigNumber(unitValue, 10);
        }

        function onUnlockFile(fileJson, account, password) {
            var state, balance_nas;

            try {
                account.fromKey(fileJson, password);
                $("#from_addr").val(account.getAddressString());
                $("#unlock").hide();
                $("#send").show();

                api.getUserGetGasPrice().then(done, fail);

                // api.postUserAccountState($("#from_addr").val())
                //     .then(done, fail);


            } catch (e) {
                bootbox.dialog({
                    message: e,
                    size: "large",
                    title: "Error"
                });
            }
        }

        function done(x) {
            $("#gas_price").append(x.gas_price);
            $("#gas_limit").append(x.gas_price);
        };

        function fail() {
        };

        $(function () {

            $(".search").click(function () {

                if ($("#addr_input").val().length < 48) {

                    $(".errmsg").removeClass("active1");

                    setTimeout(function () {
                        $(".errmsg").addClass("active1");
                    }, 2000);

                } else {

                    api.postUserGetTransactionReceipt($("#addr_input").val()).then(done, fail);
                    $(".search_result").removeClass("active1");
                }
            });

            function done(o) {
                console.log(o);
                console.log(o.contract_address);


                $(".search_result").append(o.datd);
                $("#to_addr").append(o.contract_address);


            }

            function fail() {
            }

            $("#run").click(function () {

                if ($("#code").val().length < 10) {

                    $(".errmsg_code").removeClass("active1");

                } else {

                    $(".result").removeClass("active1");

                    $(".next").removeClass("active1");

                }
            });

        })

            $("#call").click(function () {
                api.postUserCall(
                    $("#from_addr").val(), 
                    $("#to_addr").val(), 
                    $("#value").val(), nonce, 
                    $("#gas_limit").val(), 
                    $("#gas_price").val(), 
                    $("#code").val()
                ).then(done, fail);
            })
            

    </script>
</body>

</html>